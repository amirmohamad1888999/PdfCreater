<configuration>
  <system.webServer>
    <httpProtocol>
      <customHeaders>
        <!-- Cache-control and Pragma Headers -->
        <add name="Cache-Control" value="no-store, no-cache, must-revalidate, max-age=0" />
        <add name="Pragma" value="no-cache" />

        <!-- X-Content-Type-Options Header -->
        <add name="X-Content-Type-Options" value="nosniff" />

        <!-- Server Header Removal -->
        <remove name="X-Powered-By" />

        <!-- XSS Protection -->
        <add name="X-XSS-Protection" value="1; mode=block" />

        <!-- Content-Security-Policy (with properly formatted nonces) -->
<add name="Content-Security-Policy" value="default-src 'none'; script-src 'self'; style-src 'self'; font-src 'self'; connect-src 'self'; img-src 'self'; frame-src 'none'; frame-ancestors 'none'; media-src 'none'; object-src 'none'; manifest-src 'self'; worker-src 'none'; form-action 'none'" />
        <!-- X-Frame-Options -->
        <add name="X-Frame-Options" value="SAMEORIGIN" />

        <!-- HSTS (HTTP Strict Transport Security) -->
        <add name="Strict-Transport-Security" value="max-age=31536000; includeSubDomains" />

        <!-- Referrer-Policy -->
        <add name="Referrer-Policy" value="no-referrer" />

        <!-- Permissions-Policy (formerly Feature-Policy) -->
        <add name="Permissions-Policy" value="geolocation=(), microphone=(), camera=()" />

        <!-- Remove Server Header (only if using proxy_pass) -->
        <!-- For IIS, Server header removal might need more advanced techniques; this is just a placeholder -->
        <remove name="Server" />
      </customHeaders>
    </httpProtocol>

    <security>
      <requestFiltering>
        <!-- Disable TRACE Method -->
        <verbs>
          <remove verb="TRACE" />
        </verbs>
      </requestFiltering>
    </security>

    <rewrite>
      <outboundRules>
        <rule name="Remove Server Header">
          <match serverVariable="RESPONSE_Server" pattern=".+" />
          <action type="Rewrite" value="" />
        </rule>
      </outboundRules>
    </rewrite>
  </system.webServer>
  
  <system.web>
    <!-- Anti-CSRF Token Configuration -->
    <pages enableEventValidation="true" viewStateEncryptionMode="Always" />
    <httpCookies httpOnlyCookies="true" requireSSL="true" />
  </system.web>
</configuration>
